using JetBrains.Annotations;
using Perfolizer.Mathematics.Distributions.ContinuousDistributions;
using Perfolizer.Tests.Common;

namespace Perfolizer.Tests.Mathematics.Distributions.ContinuousDistributions;

public class GumbelDistributionTests : DistributionTestsBase
{
    public GumbelDistributionTests(ITestOutputHelper output) : base(output)
    {
    }


    private static readonly List<TestData> TestDataList = new()
    {
        new TestData(new GumbelDistribution(),
            new[]
            {
                -10, -9.8, -9.6, -9.4, -9.2, -9, -8.8, -8.6, -8.4, -8.2, -8,
                -7.8, -7.6, -7.4, -7.2, -7, -6.8, -6.6, -6.4, -6.2, -6, -5.8,
                -5.6, -5.4, -5.2, -5, -4.8, -4.6, -4.4, -4.2, -4, -3.8, -3.6,
                -3.4, -3.2, -3, -2.8, -2.6, -2.4, -2.2, -2, -1.8, -1.6, -1.4,
                -1.2, -1, -0.799999999999999, -0.6, -0.399999999999999, -0.199999999999999,
                0, 0.200000000000001, 0.4, 0.600000000000001, 0.800000000000001,
                1, 1.2, 1.4, 1.6, 1.8, 2, 2.2, 2.4, 2.6, 2.8, 3, 3.2, 3.4, 3.6,
                3.8, 4, 4.2, 4.4, 4.6, 4.8, 5, 5.2, 5.4, 5.6, 5.8, 6, 6.2, 6.4,
                6.6, 6.8, 7, 7.2, 7.4, 7.6, 7.8, 8, 8.2, 8.4, 8.6, 8.8, 9, 9.2,
                9.4, 9.6, 9.8, 10
            },
            new[]
            {
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4.15488704428186e-317,
                2.52061069985458e-259, 4.94807504664517e-212, 2.50534787020059e-173,
                1.17932023743105e-141, 9.71298219352884e-116, 1.5474099561895e-94,
                3.41033417623743e-77, 5.20542710849564e-63, 2.05735715354128e-51,
                6.19819588748014e-42, 3.44534655812378e-34, 7.286705787631e-28,
                1.06048039970428e-22, 1.72520723688492e-18, 4.66711893658041e-15,
                2.90641705075571e-12, 5.43750726676861e-10, 3.80054250404436e-08,
                1.18632914440637e-06, 1.91398495015808e-05, 0.000179887953645616,
                0.00108626127745233, 0.00456628142012792, 0.0142692634455675,
                0.0349781245974552, 0.0702847826336932, 0.120017594905419, 0.179374078734017,
                0.240378400508395, 0.29460529535388, 0.335603559643445, 0.360089467289227,
                0.367879441171442, 0.36105291477093, 0.342898756467732, 0.31701327275429,
                0.286697116378904, 0.254646380043582, 0.222863854497548, 0.192704574679115,
                0.164985692989649, 0.140114001931851, 0.118204951593143, 0.0991815610617284,
                0.0828504624550903, 0.0689569020010669, 0.057222387768033, 0.0473690096779079,
                0.039134055595673, 0.0322778749361675, 0.0265872441233569, 0.021875876655616,
                0.0179832296967136, 0.0147723871078632, 0.0121275283534227, 0.00995130246130573,
                0.0081622962447539, 0.00669269967753551, 0.0054862157249855,
                0.00449622743792729, 0.00368421477193883, 0.00301840251906351,
                0.00247261557301491, 0.00202531622395756, 0.00165879879292298,
                0.00135851869452908, 0.00111253534332474, 0.000911050815848221,
                0.000746028626025509, 0.000610879245359485, 0.000500201044462365,
                0.000409567130615808, 0.000335350111601355, 0.000274578145746884,
                0.000224816764550182, 0.000184071901844253, 0.000150710356347825,
                0.000123394575046661, 0.000101029193392106, 8.27172225686537e-05,
                6.77241494644456e-05, 5.54485246375493e-05, 4.53978686556498e-05
            },
            new[]
            {
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5.65211098842386e-320,
                4.18813904118352e-262, 1.00417750903523e-214, 6.21013648656614e-176,
                3.57045658115208e-144, 3.59172844322943e-118, 6.98900231853454e-97,
                1.88133281795361e-79, 3.50738919646464e-65, 1.69315289631366e-53,
                6.23032469740141e-44, 4.22996907779524e-36, 1.0926835640664e-29,
                1.94233760495641e-24, 3.85942175009585e-20, 1.27523062451626e-16,
                9.69966408521653e-14, 2.21644780341871e-11, 1.89217869483829e-09,
                7.21407495654723e-08, 1.42158510896624e-06, 1.6319066976151e-05,
                0.000120361180348422, 0.000617978989331093, 0.00235869338329324,
                0.00706196156220942, 0.0173320140087645, 0.0361486049131356,
                0.0659880358453125, 0.108008977696592, 0.161682814145127, 0.224961793549919,
                0.294816320729158, 0.367879441171442, 0.440991025942983, 0.511544833689042,
                0.577635844258916, 0.638056166582019, 0.692200627555346, 0.739934054783606,
                0.781455584849564, 0.817179486939029, 0.847640316515773, 0.873423018493117,
                0.895114927477049, 0.913275260860185, 0.928417664247649, 0.941001954244048,
                0.951431992900453, 0.960057400636204, 0.967177473904692, 0.973046193637919,
                0.977877598335383, 0.981851073061667, 0.985116296939658, 0.987797719145312,
                0.989998515108893, 0.991804024611649, 0.993284702067841, 0.994498623878831,
                0.995493603470415, 0.996308964961783, 0.996977023676852, 0.997524317392752,
                0.997972627265699, 0.998339822348899, 0.99864055684361, 0.998886844869487,
                0.999088533672458, 0.999253692817464, 0.999388934015782, 0.999499673771491,
                0.999590348950933, 0.999664593633393, 0.999725384143867, 0.999775157956583,
                0.999815911152764, 0.999849278284564, 0.99987659781059, 0.999898965702471,
                0.999917279355985, 0.999932273557048, 0.999944549937979, 0.999954601100799
            },
            DefaultProbs,
            new[]
            {
                double.NegativeInfinity, -1.5271796258079, -1.36405463288845, -1.25463490028586, -1.16903217588706,
                -1.09718870036495, -1.03439752551883, -0.978047902489709, -0.926529593101701,
                -0.878773939422311, -0.834032445247956, -0.791758683717269, -0.751540390486477,
                -0.713058051275318, -0.676058424132782, -0.640336938760748, -0.60572560876919,
                -0.572084496317368, -0.53929553906989, -0.507257991420096, -0.475884995327111,
                -0.445100958326711, -0.414839519111576, -0.385041947961373, -0.355655873811212,
                -0.326634259978281, -0.297934571484137, -0.269518091628409, -0.241349355985429,
                -0.213395679614111, -0.185626758862366, -0.158014333298764, -0.130531896419964,
                -0.103154446144336, -0.0758582679088254, -0.0486207445793891,
                -0.0214201884678231, 0.00576430840575981, 0.032953009000035,
                0.0601656535588834, 0.0874215717907552, 0.114739786844806, 0.142139112746671,
                0.169638246751302, 0.197255857910361, 0.225010673029409, 0.252921561100015,
                0.281007617229459, 0.309288247053012, 0.337783252598778, 0.366512920581664,
                0.395498114130809, 0.424760369004251, 0.454321995416884, 0.48420618670479,
                0.514437136173803, 0.545040163636433, 0.576041853334201, 0.60747020517853,
                0.639354801530844, 0.671726992092122, 0.70462009989703, 0.738069651925057,
                0.772113638472207, 0.80679280619957, 0.842150990724733, 0.878235495794576,
                0.915097527532861, 0.952792694071258, 0.991381583150802, 1.03093043315872,
                1.07151191672608, 1.11320606070173, 1.15610133237516, 1.20029592970882,
                1.24589932370724, 1.29303411480603, 1.34183828360933, 1.39246794131686,
                1.44510071951506, 1.49993998675952, 1.5572201467525, 1.6172133694854,
                1.68023824751668, 1.74667107877773, 1.81696079477961, 1.89164904623615,
                1.97139774444287, 2.05702764819981, 2.14957377980464, 2.25036732731245,
                2.36116084579488, 2.48432751025307, 2.62319411861302, 2.7826325333778,
                2.97019524904217, 3.19853426144539, 3.49136695008379, 3.90193865793583,
                4.60014922677658, double.PositiveInfinity
            }),
        new TestData(new GumbelDistribution(1, 2),
            new[]
            {
                -10, -9.8, -9.6, -9.4, -9.2, -9, -8.8, -8.6, -8.4, -8.2, -8,
                -7.8, -7.6, -7.4, -7.2, -7, -6.8, -6.6, -6.4, -6.2, -6, -5.8,
                -5.6, -5.4, -5.2, -5, -4.8, -4.6, -4.4, -4.2, -4, -3.8, -3.6,
                -3.4, -3.2, -3, -2.8, -2.6, -2.4, -2.2, -2, -1.8, -1.6, -1.4,
                -1.2, -1, -0.799999999999999, -0.6, -0.399999999999999, -0.199999999999999,
                0, 0.200000000000001, 0.4, 0.600000000000001, 0.800000000000001,
                1, 1.2, 1.4, 1.6, 1.8, 2, 2.2, 2.4, 2.6, 2.8, 3, 3.2, 3.4, 3.6,
                3.8, 4, 4.2, 4.4, 4.6, 4.8, 5, 5.2, 5.4, 5.6, 5.8, 6, 6.2, 6.4,
                6.6, 6.8, 7, 7.2, 7.4, 7.6, 7.8, 8, 8.2, 8.4, 8.6, 8.8, 9, 9.2,
                9.4, 9.6, 9.8, 10
            },
            new[]
            {
                6.59528710918849e-105, 7.73704978094592e-95, 9.89827839116942e-86,
                1.70516708811842e-77, 4.78699099427886e-70, 2.60271355424782e-63,
                3.20407499357036e-57, 1.02867857677064e-51, 9.78822113745982e-47,
                3.09909794374011e-42, 3.62536528930062e-38, 1.72267327906176e-34,
                3.6226181224025e-31, 3.64335289381528e-28, 1.87985105366487e-25,
                5.30240199852139e-23, 8.6597916793686e-21, 8.62603618442465e-19,
                5.49311253026149e-17, 2.3335594682902e-15, 6.87294137716774e-14,
                1.45320852537784e-12, 2.27652446322737e-11, 2.71875363338428e-10,
                2.54000836655634e-09, 1.90027125202218e-08, 1.16276768769364e-07,
                5.93164572203182e-07, 2.56672727238811e-06, 9.56992475079039e-06,
                3.118288593831e-05, 8.99439768228076e-05, 0.000232335145655917,
                0.000543130638726165, 0.00116002108984579, 0.00228314071006396,
                0.00417332740361131, 0.00713463172278374, 0.0114806235623595,
                0.0174890622987276, 0.0253535568049904, 0.0351423913168467, 0.0467732487133022,
                0.0600087974527093, 0.0744734044554875, 0.0896870393670086, 0.105109744207766,
                0.120189200254197, 0.134404699090889, 0.14730264767694, 0.158520960538971,
                0.167801779821723, 0.174993580579211, 0.180044733644614, 0.182991038252879,
                0.183939720585721, 0.18305207594887, 0.180526457385465, 0.176582798156004,
                0.171449378233866, 0.165352149445209, 0.158506636377145, 0.151112228315484,
                0.143348558189452, 0.135373610160804, 0.127323190021791, 0.119311415840652,
                0.111431927248774, 0.103759560616758, 0.0963522873395574, 0.0892532592565605,
                0.0824928464948244, 0.0760905877352041, 0.0700570009659255, 0.0643952246652047,
                0.0591024757965716, 0.0541713228746052, 0.0495907805308642, 0.0453472372777252,
                0.0414252312275451, 0.0378080899587133, 0.0344784510005335, 0.0314186789064773,
                0.0286111938840165, 0.0260387256602845, 0.023684504838954, 0.0215324025516068,
                0.0195670277978365, 0.0177737905471689, 0.0161389374680838, 0.0146495660666408,
                0.0132936220616785, 0.0120598839912309, 0.010937938327808, 0.00991814776848466,
                0.00899161484835682, 0.00815014259175378, 0.00738619355393158,
                0.00669284830682495, 0.00606376417671137, 0.0054931348412014
            },
            new[]
            {
                5.39068619726036e-107, 6.98900231853315e-97, 9.88163722125237e-88,
                1.88133281795329e-79, 5.83701418070483e-72, 3.50738919646464e-65,
                4.7718821210186e-59, 1.69315289631366e-53, 1.78053167155746e-48,
                6.23032469740141e-44, 8.0548340897409e-40, 4.22996907779494e-36,
                9.83074155449743e-33, 1.09268356406634e-29, 6.23083226320936e-27,
                1.94233760495641e-24, 3.50581472625787e-22, 3.85942175009585e-20,
                2.71618226092945e-18, 1.27523062451626e-16, 4.15089692010905e-15,
                9.69966408521639e-14, 1.67930865740466e-12, 2.21644780341868e-11,
                2.28850701972654e-10, 1.89217869483829e-09, 1.27958444708893e-08,
                7.21407495654723e-08, 3.44996444807885e-07, 1.42158510896624e-06,
                5.11929429867073e-06, 1.63190669761509e-05, 4.65873061192629e-05,
                0.000120361180348422, 0.000284104078721294, 0.000617978989331093,
                0.00124839763464426, 0.00235869338329323, 0.00419464154138939,
                0.00706196156220942, 0.0113142863804596, 0.0173320140087645,
                0.0254943946757241, 0.0361486049131355, 0.0495800856955671, 0.0659880358453125,
                0.085468865875946, 0.108008977696592, 0.133486796658084, 0.161682814145127,
                0.192295645547965, 0.224961793549919, 0.259276865990828, 0.294816320729158,
                0.331154277152909, 0.367879441171442, 0.404607661664132, 0.440991025942983,
                0.476723690714594, 0.511544833689042, 0.545239211892605, 0.577635844258916,
                0.608605317804406, 0.638056166582019, 0.665930705440122, 0.692200627555346,
                0.716862603474862, 0.739934054783606, 0.761449220009415, 0.781455584849564,
                0.800010713004354, 0.817179486939029, 0.833031748536221, 0.847640316515773,
                0.861079349396834, 0.873423018493117, 0.884744453965177, 0.895114927477049,
                0.904603236859614, 0.913275260860185, 0.921193655175516, 0.928417664247649,
                0.935003026556608, 0.941001954244048, 0.946463170770117, 0.951431992900453,
                0.955950445625915, 0.960057400636204, 0.963788730713586, 0.967177473904692,
                0.970254002591062, 0.973046193637919, 0.97557959668084, 0.977877598335383,
                0.979961580707383, 0.981851073061667, 0.983563895891866, 0.985116296939658,
                0.986523078951377, 0.987797719145312, 0.988952480503795
            },
            DefaultProbs,
            new[]
            {
                double.NegativeInfinity, -2.0543592516158, -1.72810926577689, -1.50926980057172, -1.33806435177411,
                -1.1943774007299, -1.06879505103767, -0.956095804979419, -0.853059186203401,
                -0.757547878844622, -0.668064890495912, -0.583517367434538, -0.503080780972953,
                -0.426116102550635, -0.352116848265565, -0.280673877521496, -0.21145121753838,
                -0.144168992634737, -0.0785910781397803, -0.014515982840192,
                0.0482300093457789, 0.109798083346578, 0.170320961776847, 0.229916104077253,
                0.288688252377577, 0.346731480043438, 0.404130857031726, 0.460963816743182,
                0.517301288029141, 0.573208640771778, 0.628746482275269, 0.683971333402472,
                0.738936207160072, 0.793691107711328, 0.848283464182349, 0.902758510841222,
                0.957159623064354, 1.01152861681152, 1.06590601800007, 1.12033130711777,
                1.17484314358151, 1.22947957368961, 1.28427822549334, 1.3392764935026,
                1.39451171582072, 1.45002134605882, 1.50584312220003, 1.56201523445892,
                1.61857649410602, 1.67556650519756, 1.73302584116333, 1.79099622826162,
                1.8495207380085, 1.90864399083377, 1.96841237340958, 2.02887427234761,
                2.09008032727287, 2.1520837066684, 2.21494041035706, 2.27870960306169,
                2.34345398418424, 2.40924019979406, 2.47613930385011, 2.54422727694441,
                2.61358561239914, 2.68430198144947, 2.75647099158915, 2.83019505506572,
                2.90558538814252, 2.9827631663016, 3.06186086631745, 3.14302383345216,
                3.22641212140346, 3.31220266475032, 3.40059185941764, 3.49179864741448,
                3.58606822961205, 3.68367656721866, 3.78493588263372, 3.89020143903011,
                3.99987997351903, 4.114440293505, 4.2344267389708, 4.36047649503336,
                4.49334215755546, 4.63392158955922, 4.78329809247229, 4.94279548888574,
                5.11405529639963, 5.29914755960928, 5.50073465462489, 5.72232169158975,
                5.96865502050613, 6.24638823722604, 6.5652650667556, 6.94039049808433,
                7.39706852289078, 7.98273390016757, 8.80387731587167, 10.2002984535532,
                double.PositiveInfinity
            })
    };

    [UsedImplicitly]
    public static TheoryData<string> TestDataKeys = TheoryDataHelper.Create(TestDataList.Select(it => it.Distribution.ToString()!));

    [Theory]
    [MemberData(nameof(TestDataKeys))]
    public void GumbelDistributionTest(string testKey)
    {
        Check(TestDataList.First(it => it.Distribution.ToString() == testKey));
    }

    [Fact]
    public void GumbelDistributionTest1()
    {
        var gumbel = new GumbelDistribution();
        AssertEqual("Location", 0, gumbel.Location);
        AssertEqual("Scale", 1, gumbel.Scale);
        AssertEqual("Mean", 0.5772156649015329, gumbel.Mean);
        AssertEqual("Median", 0.36651292058166435, gumbel.Median);
        AssertEqual("Variance", 1.6449340668482264, gumbel.Variance);
    }

    [Fact]
    public void GumbelDistributionTest2()
    {
        var gumbel = new GumbelDistribution(1, 2);
        AssertEqual("Location", 1, gumbel.Location);
        AssertEqual("Scale", 2, gumbel.Scale);
        AssertEqual("Mean", 2.1544313298030655, gumbel.Mean);
        AssertEqual("Median", 1.7330258411633288, gumbel.Median);
        AssertEqual("Variance", 6.579736267392906, gumbel.Variance);
    }
}